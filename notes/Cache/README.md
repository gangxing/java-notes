缓存更新设计模式

https://coolshell.cn/articles/17416.html

* Cache Aside Pattern

  读取：先从缓存中获取数据，如果未获取到再从数据库获取数据，获取到后设置到缓存中

  更新：先更新数据库，成功后，再将缓存失效

* Read Through Pattern

  在 Cache Aside模式中，应用程序自己维护cache和数据库两处数据，Read Through(Write Through)模式是将缓存和数据库组合成一个统一的数据层，应用层只从统一的数据层获取数据，更新缓存的策略和Cache Aside相同，只不过是由数据层自己实现，对应用层透明。

* Write Through Pattern

  和Read Through类似，将缓存和数据库统一成数据层，只不过发生在数据更新时，如果命中缓存，则更新缓存，然后更新数据库；如果未命中，直接更新数据库然后返回。

* Write Behind Caching Pattern

  更新数据的时候，只更新缓存，异步批量更新数据库。

  优点：异步，加快了响应；批量：减少磁盘IO

  缺点：数据不是强一致性的，并且存在丢失的可能性（在内存中，还未持久化）；实现逻辑复杂，需要维护哪些数据需要持久化。



因为一份数据存储在两个地方，上面这四种模式都没有考虑缓存层和数据库层的整体事务，所以不能保证强一致性，如果需要强一致性，则需要两阶段提交等分布式事务来保证，但是会降低性能。





